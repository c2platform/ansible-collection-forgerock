{{ ansible_managed|comment(decoration="// ") }}
{{ item|c2platform.forgerock.amster_script_header|comment(decoration="// ") }}
connect {{ amster_am_connect|c2platform.forgerock.ds_cmd }} {{ amster_am_install['serverUrl'] }}
{{ am_amster_common_functions }}
try {
{{ lookup('template', './params.groovy.j2')|indent(2, True) }}

    BODY="""{
        "_id":"",
        "cookieDomains":$cookieDomains,
        "locale":"en_US",
        "_type":{
        "_id":"platform",
        "name":"Platform",
        "collection":false
        }
    }"""

    platform_cur=eval("read Platform --global")
    if(isNull(eval("update Platform --global --body '$BODY'"))){
        println red("{{ am_amster_stdout_tags['error'] }} in reading the platform settings")
    }else{
        println green("reading the platform was successful")
    }
    platform_new=eval("read Platform --global")
    if (resourceChange(platform_cur,platform_new)) {
      println green("{{ am_amster_stdout_tags['changed'] }} cookieDomains was changed")
    }
} catch(Exception e) {
   println("{{ am_amster_stdout_tags['error'] }} ${e.getMessage()} ")
}
:quit